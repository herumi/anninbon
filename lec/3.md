## 前回のおさらい

- 絶対安全な暗号は秘密鍵が大きくないといけない。
- 利便性のために攻撃コストが大きい暗号を安全と考える。

## 共通鍵暗号

「暗号鍵 = 復号鍵」である暗号方式
  - 暗号鍵 = 復号鍵 = 秘密鍵は第三者に秘密にする

### 共通鍵暗号のアルゴリズム

- 秘密鍵sを生成してアリスとボブで共有する
- 平文mを秘密鍵sで暗号化して暗号文cを得る ; c = Enc(s, m)
- 暗号文cを秘密鍵sで復号して元の平文mを得る ; m = Dec(s, c)
  - 秘密鍵を省略してc = Enc(m)やm = Dec(c)と書くこともある

暗号化して復号すると元に戻る

Dec(s, Enc(s, m)) = m

### 強秘匿性

暗号文から元の平文の(長さ以外の)情報を少しも推測できないこと

- 「This is a pocket」をAESで暗号化
  - 927ab73513c69781e86589694fabcc12
- 「This is a packet」をAESで暗号化
  - 527611079cb35819d61b389c3aae3579

### 攻撃の種類

状況によって攻撃者の能力をいくつかに分類する

- 選択平文攻撃 CPA(Chosen Plaintext Attack)
  - 攻撃者が平文を自由に選んで、その暗号文をゲットできる状況
- 選択暗号文攻撃  CCA(Chosen Ciphertext Attack)
  - 攻撃者が暗号文を自由に選んで、その平文をゲットできる状況

### 理想の共通鍵暗号

- nビットの秘密鍵は2^n通り
- 2^n通り試せばどれか一つ正解
  - この方法(ブルートフォース攻撃)しか無いとき、この共通鍵暗号はnビットセキュリティの安全性という
  - 128ビット以上の秘密鍵を使うのが一般的

### 共通鍵暗号の種類

- ブロック暗号
- ストリーム暗号

## 排他的論理和

0と1を入力とする操作(演算, 変換)を考える

入力 : a | 入力 : b | 出力 : a ⊕ b
--|--|--
 0| 0| 0
 0| 1| 1
 1| 0| 1
 1| 1| 0

- この表を真理値表という
- a = 0のときはbはそのまま出力される(恒等変換)
- a = 1のときはbの否定(not)が出力される
- 同じ値の排他的論理和は0(a ⊕ a = 0)

### 排他的論理和の性質

- 交換法則
  - a ⊕ b = b ⊕ a
- 結合法則
  - (a ⊕ b) ⊕ c = a ⊕ (b ⊕ c)= a ⊕ b ⊕ c

2回同じ値を排他的論理和すると元に戻るので

(a ⊕ b) ⊕ b = a

これが暗号にとって重要な性質

- aを平文
- bを鍵とするとc = a ⊕ bは暗号文
- cにもう一度⊕ bするとc ⊕ b = aに戻る

## 乱数
(真の)乱数列 ; 次にどんな値が来るか全く予測できない数字の列

- 攻撃者は過去の乱数列を見て次にくる0か1を1/2より大きい確率で当てようとする
- どんなに頑張ってもあたる確率が1/2なとき安全な乱数

### コンピュータで扱う乱数

- コンピュータは同じ計算をするのは得意
- 乱数を作るのは苦手
  - メモリ、ディスクなど様々な変動する情報を集めて乱数のタネにする
  - 量子的なゆらぎを利用することもある
  - CPUの命令で実装されていることもある

- 2019年7月、AMDのCPUで乱数生成命令が固定値を返すことがあるバグ
  - https://bugs.launchpad.net/ubuntu/+source/systemd/+bug/1835809
- 2020年6月、Intel CPUの乱数生成命令が生成した乱数を別のプロセスから盗み見る攻撃が発見さた
  - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-0543
- 2013年12月 Linux 3.8.13でrdrandを攻撃すると/dev/urandomが同じ値を出す問題
  - https://twitter.com/defusesec/status/408975222163795969

### 擬似乱数

疑似乱数生成器 ; シードを与えて擬似的に乱数を生成する装置・アルゴリズム

### 擬似ランダム関数

PRF(PseudoRandom Function)

シードsを与えると任意の値に対して擬似乱数を生成する関数

## ワンタイムパッド

情報理論的安全性を持つ共通鍵暗号

### 情報理論的安全性

- 暗号文から平文の情報が一切漏れない暗号
- (量子コンピュータを含む)どんなコンピュータでも破れない
  - 注意 : たまたま当たる確率1/2^nはある(nは秘密鍵のビット数)

### ワンタイムパッドの欠点

- 秘密鍵は真の乱数
- 秘密鍵のサイズ = 平文のサイズ
- 秘密鍵は一度しか使えない

## ストリーム暗号

ワンタイムパッドの秘密鍵を疑似乱数に置き換えたもの
